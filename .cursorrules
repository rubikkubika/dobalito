# Cursor Rules for Dobalito Project

## ğŸ³ Docker Files Organization (STRICT RULE)
**ALL Docker-related files MUST be placed in the `docker/` directory**

### Required Placement:
- âœ… `docker/docker-compose.yml` - Main compose file
- âœ… `docker/Dockerfile.frontend` - Frontend Dockerfile  
- âœ… `docker/Dockerfile.backend` - Backend Dockerfile
- âœ… `docker/Dockerfile.fullstack` - Full-stack Dockerfile
- âœ… `docker/nginx.conf` - Nginx configuration
- âœ… `docker/*.sh` - Docker scripts

### Forbidden Placement:
- âŒ `docker-compose.yml` (in root)
- âŒ `Dockerfile` (in root)
- âŒ `nginx.conf` (in root)
- âŒ Any Docker files outside `docker/` directory

## ğŸ“ Project Structure Rules
- Keep Docker configurations centralized in `docker/` folder
- Use `docker/` as build context for Docker operations
- Maintain consistency with existing Docker file organization
- Reference Docker files with paths relative to `docker/` directory

## ğŸ”§ Build Context Guidelines
When creating Docker configurations:
- Build context: `docker/` directory
- Dockerfile paths: `docker/Dockerfile.*`
- Compose file paths: `docker/docker-compose.*`

## ğŸ“ File Naming Conventions
- Docker Compose: `docker-compose.yml`, `docker-compose.*.yml`
- Dockerfiles: `Dockerfile`, `Dockerfile.*`
- Config files: descriptive names (`nginx.conf`, `postgres.conf`)

## âš ï¸ Enforcement
- Always place new Docker files in `docker/` directory
- Update build contexts when referencing Docker files
- Maintain existing Docker file organization patterns

## ğŸŒ HTTP Client Rules
**ALWAYS use timeout with curl commands**

### Required curl usage:
- âœ… `curl.exe --max-time 10 -s http://localhost:3001` (Windows PowerShell)
- âœ… `curl --max-time 10 -s http://localhost:3001` (Linux/Mac)
- âœ… `curl.exe --connect-timeout 5 --max-time 10 -s http://localhost:8080/api/v1/health`
- âŒ `curl http://localhost:3001` (no timeout)
- âŒ `curl -s http://localhost:3001` (no timeout)

### Timeout guidelines:
- `--connect-timeout 5` - Connection timeout (5 seconds)
- `--max-time 10` - Total timeout (10 seconds)
- Always use `-s` for silent mode
- Use `-f` for fail on HTTP errors when needed
- On Windows PowerShell, use `curl.exe` instead of `curl`

## ğŸ”„ Service Restart Rules
**ALWAYS check what's running first, then restart accordingly**

### MANDATORY restart sequence (NEVER skip steps):
1. **Check local processes**: 
   - Windows: `tasklist | findstr java.exe` AND `tasklist | findstr node.exe`
   - Linux/Mac: `ps aux | grep java` AND `ps aux | grep node`
2. **Check Docker containers**: `docker-compose -f docker/docker-compose.yml ps`
3. **Check port usage**: `netstat -ano | findstr :8080` (Windows) or `lsof -i :8080` (Linux/Mac)
4. **Stop ALL conflicting processes**:
   - If restarting locally: `docker-compose -f docker/docker-compose.yml down`
   - If restarting via Docker: `taskkill /f /im java.exe` AND `taskkill /f /im node.exe`
5. **Start services based on request**:
   - For local backend restart: Create local DB + `cd backend; $env:SPRING_DATASOURCE_URL="jdbc:postgresql://localhost:5432/dobalito"; $env:SPRING_DATASOURCE_USERNAME="postgres"; $env:SPRING_DATASOURCE_PASSWORD="root"; mvn spring-boot:run`
   - For Docker restart: `docker-compose -f docker/docker-compose.yml up -d`
6. **MANDATORY verification**: 
   - Wait 15-20 seconds for startup
   - Test with curl: `curl.exe --max-time 10 -s http://localhost:8080/api/v1/health`
   - Verify port is listening: `netstat -ano | findstr :8080`

### Context-aware restart:
- **"Ğ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸ Ğ±ÑĞº Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾"** â†’ Stop Docker, start locally with Maven + local DB
- **"Ğ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸ Ñ„Ñ€Ğ¾Ğ½Ñ‚ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾"** â†’ Stop Docker, start locally with npm
- **"Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹ Ñ‡ĞµÑ€ĞµĞ· docker"** â†’ Stop local processes, start Docker
- **"Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹"** â†’ Check what's running, restart accordingly

## ğŸ  Local Backend Database Rules
**When user requests "Ğ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ±ÑĞº Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾" or "Ğ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ±ÑĞºĞµĞ½Ğ´ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾":**

### MANDATORY local database setup:
1. **ALWAYS use local PostgreSQL database `dobalito`**
2. **Connection string**: `jdbc:postgresql://localhost:5432/dobalito`
3. **Credentials**: username=`postgres`, password=`root`
4. **Create database if not exists**:
   ```bash
   $env:PGPASSWORD="root"; & "C:\Program Files\PostgreSQL\18\bin\psql.exe" -U postgres -h localhost -c "CREATE DATABASE dobalito;"
   ```
5. **Start backend with local DB**:
   ```bash
   cd backend; $env:SPRING_DATASOURCE_URL="jdbc:postgresql://localhost:5432/dobalito"; $env:SPRING_DATASOURCE_USERNAME="postgres"; $env:SPRING_DATASOURCE_PASSWORD="root"; mvn spring-boot:run
   ```

### CRITICAL requirements:
- âœ… ALWAYS create `dobalito` database if it doesn't exist
- âœ… ALWAYS use local PostgreSQL (not Docker database)
- âœ… ALWAYS set environment variables for local DB connection
- âœ… ALWAYS run Maven from backend directory
- âœ… ALWAYS verify local database connection before starting
- âŒ NEVER use Docker database for local backend runs
- âŒ NEVER assume database exists without checking/creating

### CRITICAL requirements:
- âœ… ALWAYS check BOTH Java AND Node processes
- âœ… ALWAYS check Docker containers status
- âœ… ALWAYS check port conflicts (8080, 3000, 3001)
- âœ… ALWAYS stop conflicting processes BEFORE starting
- âœ… ALWAYS wait for startup completion (15-20 seconds)
- âœ… ALWAYS verify with curl requests
- âœ… ALWAYS confirm port is listening
- âŒ NEVER assume services are running without verification
- âŒ NEVER skip process checking steps
- âŒ NEVER start services without stopping conflicts first

### Maven/Node.js specific rules:
- **Maven commands**: Run from current directory (assumes backend/ is current)
- **PowerShell syntax**: Use `;` instead of `&&` for command chaining
- **Background processes**: Use `is_background: true` for long-running commands
- **Error handling**: If Maven fails, check pom.xml and dependencies
- **Port conflicts**: Always verify port 8080 is free before starting backend
- **Directory assumption**: Assume current directory is backend/ when running Maven

### Enforcement:
- MANDATORY: Complete all 6 steps in sequence
- MANDATORY: Verify service availability after each restart
- MANDATORY: Report status clearly to user
- MANDATORY: Follow user's explicit restart preference (local vs Docker)
- MANDATORY: Use correct PowerShell syntax (no `&&` operators)
- MANDATORY: Run Maven from current directory (assume backend/)

## ğŸš€ Local Development Rules
**ALWAYS run npm start in background to avoid blocking chat**

### Required npm start usage:
- âœ… `npm start` (with is_background: true) - Run in background
- âœ… `Start-Job -ScriptBlock { npm start }` (PowerShell) - Background job
- âœ… `nohup npm start > npm.log 2>&1 &` (Linux/Mac) - Background with logs
- âŒ `npm start` (with is_background: false) - Blocks chat and terminal

### Why background execution:
- âœ… Prevents chat blocking during development
- âœ… Allows continued interaction with assistant
- âœ… Enables parallel command execution
- âœ… Maintains development workflow continuity

### Enforcement:
- NEVER run npm start in foreground mode
- ALWAYS use is_background: true for npm start commands
- ALWAYS verify service availability after background start
- Use Docker as preferred development environment when possible

## ğŸŒ Internationalization Rules
**ALWAYS update translations for both languages when modifying frontend elements**

### Required i18n workflow:
- âœ… When adding new text elements: Add translations to `LanguageContext.tsx` for both `ru` and `en`
- âœ… When modifying existing text: Update both language versions in `LanguageContext.tsx`
- âœ… When creating new pages: Use `useLanguage()` hook and `t()` function for all text
- âœ… When updating UI components: Ensure all hardcoded text uses translation keys
- âŒ Never add hardcoded Russian/English text directly in components
- âŒ Never update only one language without updating the other

### Translation key structure:
- **Navigation**: `nav.*` (nav.home, nav.profile, nav.settings, nav.designs)
- **Home page**: `home.*` (home.welcome, home.subtitle, home.categories, home.features)
- **Categories**: `category.*` (category.surfing, category.bike_rental)
- **Features**: `feature.*` (feature.create_tasks, feature.find_executors, etc.)
- **Executors**: `executors.*` (executors.title, executors.back, executors.empty)
- **Language selector**: `lang.*` (lang.russian, lang.english)

### Required implementation pattern:
```typescript
// âœ… CORRECT - Using translations
const { t } = useLanguage();
<Typography>{t('home.welcome')}</Typography>

// âŒ WRONG - Hardcoded text
<Typography>Ğ”Ğ¾Ğ±Ñ€Ğ¾ Ğ¿Ğ¾Ğ¶Ğ°Ğ»Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ² doBalito</Typography>
```

### LanguageContext.tsx structure:
```typescript
const translations = {
  ru: {
    'key.name': 'Russian text',
    // ... all Russian translations
  },
  en: {
    'key.name': 'English text',
    // ... all English translations
  },
};
```

### Enforcement:
- ALWAYS add new translation keys to both `ru` and `en` objects
- ALWAYS use `t()` function instead of hardcoded text
- ALWAYS test both language versions when making changes
- ALWAYS maintain consistent translation key naming
- NEVER leave incomplete translations (missing keys in one language)

## ğŸš« Service Auto-Start Rules
**NEVER start services automatically without explicit user request**

### Required behavior:
- âœ… Only start services when user explicitly asks (e.g., "Ğ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹", "start services", "Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸")
- âœ… When creating new entities/features: Just create the code, don't start services
- âœ… When adding dependencies: Just update configuration, don't restart
- âœ… When modifying code: Just make changes, don't auto-restart
- âŒ NEVER run `docker-compose up` or `npm start` without user request
- âŒ NEVER restart services after code changes unless asked
- âŒ NEVER assume user wants services running after modifications

### When to start services:
- User says: "Ğ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹", "start services", "Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸"
- User says: "Ğ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸ Ñ„Ñ€Ğ¾Ğ½Ñ‚", "start frontend"
- User says: "Ğ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸ Ğ±ÑĞºĞµĞ½Ğ´", "start backend"
- User says: "Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸ Ñ‡ĞµÑ€ĞµĞ· docker", "restart with docker"
- User explicitly requests testing or verification

### When NOT to start services:
- After creating new entities (User, Category, etc.)
- After adding new dependencies
- After modifying existing code
- After creating new controllers/services
- After updating configuration files
- When user just asks to "add" or "create" something

### Enforcement:
- ALWAYS ask user if they want to start services after major changes
- ALWAYS inform user that services are ready but not started
- ALWAYS let user decide when to start/restart services
- NEVER assume user wants immediate service restart
- ALWAYS respect user's development workflow preferences

## ğŸ“ Temporary Files Management Rules
**ALL temporary files MUST be placed in the `temp/` directory**

### Required Placement:
- âœ… `temp/` - All temporary files and folders
- âœ… `temp/debug/` - Debug files and logs
- âœ… `temp/test/` - Test files and outputs
- âœ… `temp/cookies*.txt` - Cookie files
- âœ… `temp/*.log` - Log files
- âœ… `temp/*.tmp` - Temporary files

### Forbidden Placement:
- âŒ Temporary files in project root
- âŒ Temporary files in backend/ or frontend-react/
- âŒ Temporary files in git-tracked directories
- âŒ Log files outside temp/ directory

### Temporary file types:
- **Debug files**: `*.debug`, `*.test`, `*.tmp`
- **Log files**: `*.log`, `*.error.log`, `maven*.log`
- **Cookie files**: `cookies*.txt`, `cookies-after-*.txt`
- **Backup files**: `*.bak`, `*.backup`
- **IDE temp files**: `*.swp`, `*.swo`, `*~`

### Git exclusion:
- All files in `temp/` directory are automatically ignored by git
- Temporary files are never committed to repository
- Clean up temp/ directory regularly

### Enforcement:
- ALWAYS create temporary files in `temp/` directory
- ALWAYS use descriptive subdirectories in `temp/`
- ALWAYS clean up temporary files after debugging
- NEVER commit temporary files to git
- ALWAYS use `temp/` for any development artifacts

## ğŸ“š Documentation Management Rules
**ALL documentation files MUST be placed in the `docs/` directory**

### Required Placement:
- âœ… `docs/` - All documentation files
- âœ… `docs/development/` - Development guides and rules
- âœ… `docs/user-guide/` - User documentation and guides
- âœ… `docs/api/` - API documentation
- âœ… `docs/deployment/` - Deployment guides
- âœ… `docs/architecture/` - System architecture docs

### Forbidden Placement:
- âŒ Documentation files in project root
- âŒ Documentation files in backend/ or frontend-react/
- âŒ README files outside docs/ (except main README.md)
- âŒ Documentation scattered across different directories

### Documentation file types:
- **Guides**: `*.md`, `*.rst`, `*.txt`
- **API docs**: `api-*.md`, `swagger-*.md`
- **Architecture**: `architecture-*.md`, `design-*.md`
- **Deployment**: `deploy-*.md`, `setup-*.md`
- **User guides**: `user-*.md`, `guide-*.md`

### Documentation structure:
```
docs/
â”œâ”€â”€ README.md              # Main documentation index
â”œâ”€â”€ development/           # Development guides
â”‚   â”œâ”€â”€ development-rules.md
â”‚   â”œâ”€â”€ local-backend-rule.md
â”‚   â””â”€â”€ coding-standards.md
â”œâ”€â”€ user-guide/           # User documentation
â”‚   â”œâ”€â”€ user-rules.md
â”‚   â””â”€â”€ getting-started.md
â”œâ”€â”€ api/                  # API documentation
â”‚   â”œâ”€â”€ api-reference.md
â”‚   â””â”€â”€ endpoints.md
â”œâ”€â”€ deployment/           # Deployment guides
â”‚   â”œâ”€â”€ docker-deployment.md
â”‚   â””â”€â”€ production-setup.md
â””â”€â”€ architecture/         # System architecture
    â”œâ”€â”€ system-overview.md
    â””â”€â”€ database-schema.md
```

### Git inclusion:
- All files in `docs/` directory are tracked by git
- Documentation is part of the project repository
- Keep documentation up-to-date with code changes

### Enforcement:
- ALWAYS create documentation files in `docs/` directory
- ALWAYS use appropriate subdirectories in `docs/`
- ALWAYS update documentation when making code changes
- ALWAYS maintain consistent documentation structure
- NEVER create documentation files outside `docs/`
- ALWAYS reference documentation from `docs/` in code comments
