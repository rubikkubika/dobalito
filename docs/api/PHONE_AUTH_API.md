# API Авторизации по номеру телефона

## Описание
API для авторизации пользователей через номер телефона с использованием одноразовых кодов верификации.

## Новые Endpoints

### 1. Отправка кода верификации
```
POST /api/v1/auth/send-verification-code
Content-Type: application/json

{
  "phone": "+7 900 123 45 67"
}
```

**Ответ при успехе:**
```json
{
  "success": true,
  "message": "Код верификации отправлен на номер 79001234567",
  "phone": "79001234567",
  "expiresInMinutes": 10
}
```

**Ответ при ошибке:**
```json
{
  "success": false,
  "message": "Неверный формат номера телефона"
}
```

### 2. Верификация кода и авторизация
```
POST /api/v1/auth/verify-code
Content-Type: application/json

{
  "phone": "+7 900 123 45 67",
  "code": "123456",
  "name": "Иван Петров"  // Опционально для регистрации
}
```

**Ответ при успехе:**
```json
{
  "success": true,
  "message": "Успешная авторизация",
  "user": {
    "id": 1,
    "name": "Иван Петров",
    "phone": "79001234567",
    "email": "temp_79001234567@dobalito.local",
    "avatar": ""
  }
}
```

**Ответ при ошибке:**
```json
{
  "success": false,
  "message": "Неверный или истекший код"
}
```

### 3. Проверка статуса кода
```
GET /api/v1/auth/check-code-status?phone=+7%20900%20123%2045%2067
```

**Ответ:**
```json
{
  "success": true,
  "hasActiveCode": true,
  "expiresAt": "2024-01-15T10:40:00",
  "attemptsLeft": 2
}
```

## Особенности реализации

### Нормализация номеров телефонов
- Все номера автоматически нормализуются (убираются все символы кроме цифр)
- Поддерживаются номера длиной от 10 до 15 цифр
- Пример: "+7 (900) 123-45-67" → "79001234567"

### Безопасность кодов
- Код действует 10 минут
- Максимум 3 попытки ввода кода
- Максимум 5 запросов кодов в час на один номер
- Старые коды автоматически деактивируются при генерации нового

### SMS отправка
- Пока реализована имитация отправки SMS
- Код выводится в логи сервера
- Готов к интеграции с реальным SMS API

### Создание пользователей
- При первом входе создается новый пользователь
- Генерируется временный email на основе номера телефона
- Имя можно указать при регистрации или будет "Пользователь"

## Пример использования

1. **Отправка кода:**
```bash
curl -X POST http://localhost:8080/api/v1/auth/send-verification-code \
  -H "Content-Type: application/json" \
  -d '{"phone": "+7 900 123 45 67"}'
```

2. **Проверка статуса:**
```bash
curl "http://localhost:8080/api/v1/auth/check-code-status?phone=79001234567"
```

3. **Верификация кода:**
```bash
curl -X POST http://localhost:8080/api/v1/auth/verify-code \
  -H "Content-Type: application/json" \
  -d '{"phone": "79001234567", "code": "123456", "name": "Иван Петров"}'
```

## Интеграция с SMS API

Для подключения реального SMS API необходимо:

1. Добавить конфигурацию в `application.yml`:
```yaml
sms:
  api-url: "https://api.sms-provider.com/send"
  api-key: "your-api-key"
  sender: "doBalito"
```

2. Создать DTO классы для запросов и ответов SMS API

3. Обновить метод `sendSmsViaApi()` в `SmsService`

4. Добавить обработку ошибок и retry логику
