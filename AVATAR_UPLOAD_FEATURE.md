# –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏ –∞–≤–∞—Ç–∞—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## üéØ –¶–µ–ª—å

–î–æ–±–∞–≤–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∑–∞–≥—Ä—É–∂–∞—Ç—å –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–≤–æ–∏–º–∏ –∞–≤–∞—Ç–∞—Ä–∞–º–∏ –≤ –ø—Ä–æ—Ñ–∏–ª–µ.

## üîß Backend —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### UserController endpoints

**–ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∞:**
```java
@PostMapping("/{id}/avatar")
public ResponseEntity<?> uploadAvatar(@PathVariable Long id, @RequestParam("file") MultipartFile file)
```

**–£–¥–∞–ª–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∞:**
```java
@DeleteMapping("/{id}/avatar")
public ResponseEntity<?> deleteAvatar(@PathVariable Long id)
```

**–ü–æ–ª—É—á–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∞:**
```java
@GetMapping("/avatar/{filename}")
public ResponseEntity<Resource> getAvatar(@PathVariable String filename)
```

### UserService –º–µ—Ç–æ–¥—ã

**–ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∞:**
```java
public String uploadAvatar(Long userId, MultipartFile file) throws IOException {
    // –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ uploads/avatars/
    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ —Å UUID
    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –Ω–∞ –¥–∏—Å–∫
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ URL –∞–≤–∞—Ç–∞—Ä–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
    // –í–æ–∑–≤—Ä–∞—Ç URL –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª—É
}
```

**–£–¥–∞–ª–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∞:**
```java
public boolean deleteAvatar(Long userId) {
    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ avatar = null –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
    // –§–∞–π–ª –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–∞ –¥–∏—Å–∫–µ (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ—á–∏—Å—Ç–∫—É)
}
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
uploads/
‚îî‚îÄ‚îÄ avatars/
    ‚îú‚îÄ‚îÄ uuid1.jpg
    ‚îú‚îÄ‚îÄ uuid2.png
    ‚îî‚îÄ‚îÄ uuid3.gif
```

**URL –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–≤–∞—Ç–∞—Ä—É:** `/api/v1/users/avatar/{filename}`

## üé® Frontend —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### API Service –º–µ—Ç–æ–¥—ã

```typescript
// –ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∞
async uploadAvatar(userId: number, file: File) {
  const formData = new FormData();
  formData.append('file', file);
  
  const response = await api.post(`/users/${userId}/avatar`, formData, {
    headers: {
      'Content-Type': 'multipart/form-data',
    },
  });
  return response.data;
}

// –£–¥–∞–ª–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∞
async deleteAvatar(userId: number) {
  const response = await api.delete(`/users/${userId}/avatar`);
  return response.data;
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
async updateProfile(userId: number, profileData: { name?: string; email?: string }) {
  const response = await api.put(`/users/${userId}`, profileData);
  return response.data;
}
```

### ProfilePage –∫–æ–º–ø–æ–Ω–µ–Ω—Ç

**–ù–æ–≤—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è:**
```typescript
const [avatarLoading, setAvatarLoading] = useState(false);
const fileInputRef = useRef<HTMLInputElement>(null);
```

**–§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–æ–º:**
```typescript
const handleAvatarUpload = async (event: React.ChangeEvent<HTMLInputElement>) => {
  const file = event.target.files?.[0];
  if (!file || !user?.id) return;

  // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞ (—Ç–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)
  if (!file.type.startsWith('image/')) {
    setError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ');
    return;
  }

  // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ (–º–∞–∫—Å–∏–º—É–º 5MB)
  if (file.size > 5 * 1024 * 1024) {
    setError('–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 5MB');
    return;
  }

  setAvatarLoading(true);
  setError(null);

  try {
    const response = await apiService.uploadAvatar(user.id, file);
    window.location.reload(); // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
  } catch (err: any) {
    setError(err.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∞–≤–∞—Ç–∞—Ä–∞');
  } finally {
    setAvatarLoading(false);
  }
};

const handleAvatarDelete = async () => {
  if (!user?.id) return;

  setAvatarLoading(true);
  setError(null);

  try {
    await apiService.deleteAvatar(user.id);
    window.location.reload(); // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
  } catch (err: any) {
    setError(err.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∞–≤–∞—Ç–∞—Ä–∞');
  } finally {
    setAvatarLoading(false);
  }
};
```

### UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

**–ê–≤–∞—Ç–∞—Ä —Å –∫–Ω–æ–ø–∫–∞–º–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```jsx
<Box sx={{ position: 'relative', mr: 3 }}>
  <Avatar
    src={user.avatar ? `http://localhost:8080${user.avatar}` : undefined}
    sx={{
      width: 80,
      height: 80,
      fontSize: '2rem',
      backgroundColor: '#4CAF50',
    }}
  >
    {user.name.charAt(0).toUpperCase()}
  </Avatar>
  
  {/* –ö–Ω–æ–ø–∫–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–æ–º */}
  <Box sx={{ 
    position: 'absolute', 
    bottom: -5, 
    right: -5,
    display: 'flex',
    gap: 0.5
  }}>
    {/* –ö–Ω–æ–ø–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ */}
    <IconButton
      size="small"
      onClick={() => fileInputRef.current?.click()}
      disabled={avatarLoading}
      sx={{
        backgroundColor: '#4CAF50',
        color: 'white',
        width: 24,
        height: 24,
        '&:hover': {
          backgroundColor: '#45a049',
        }
      }}
    >
      {avatarLoading ? (
        <CircularProgress size={16} color="inherit" />
      ) : (
        <PhotoCameraIcon sx={{ fontSize: 14 }} />
      )}
    </IconButton>
    
    {/* –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –∞–≤–∞—Ç–∞—Ä) */}
    {user.avatar && (
      <IconButton
        size="small"
        onClick={handleAvatarDelete}
        disabled={avatarLoading}
        sx={{
          backgroundColor: '#f44336',
          color: 'white',
          width: 24,
          height: 24,
          '&:hover': {
            backgroundColor: '#d32f2f',
          }
        }}
      >
        <DeleteIcon sx={{ fontSize: 14 }} />
      </IconButton>
    )}
  </Box>
  
  {/* –°–∫—Ä—ã—Ç—ã–π input –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞ */}
  <input
    type="file"
    ref={fileInputRef}
    onChange={handleAvatarUpload}
    accept="image/*"
    style={{ display: 'none' }}
  />
</Box>
```

## üîí –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### Frontend –≤–∞–ª–∏–¥–∞—Ü–∏—è

- ‚úÖ **–¢–∏–ø —Ñ–∞–π–ª–∞**: –¢–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (`image/*`)
- ‚úÖ **–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞**: –ú–∞–∫—Å–∏–º—É–º 5MB
- ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**: –¢–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏

### Backend –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ **–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤**: UUID –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
- ‚úÖ **–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –∑–∞–≥—Ä—É–∑–∫–∏**: –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–∞–ø–∫–∞ `uploads/avatars/`
- ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**: –í–∞–ª–∏–¥–∞—Ü–∏—è ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π

## üì± –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç

### –ü—Ä–æ—Ü–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏ –∞–≤–∞—Ç–∞—Ä–∞:

1. **–ö–ª–∏–∫ –ø–æ –∏–∫–æ–Ω–∫–µ –∫–∞–º–µ—Ä—ã** ‚Üí –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –¥–∏–∞–ª–æ–≥ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
2. **–í—ã–±–æ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è** ‚Üí –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
3. **–ó–∞–≥—Ä—É–∑–∫–∞** ‚Üí –ü–æ–∫–∞–∑ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∑–∞–≥—Ä—É–∑–∫–∏
4. **–£—Å–ø–µ—Ö** ‚Üí –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∞ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ

### –ü—Ä–æ—Ü–µ—Å—Å —É–¥–∞–ª–µ–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–∞:

1. **–ö–ª–∏–∫ –ø–æ –∏–∫–æ–Ω–∫–µ —É–¥–∞–ª–µ–Ω–∏—è** ‚Üí –ü–æ—è–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –∞–≤–∞—Ç–∞—Ä–∞
2. **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ** ‚Üí –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
3. **–£—Å–ø–µ—Ö** ‚Üí –í–æ–∑–≤—Ä–∞—Ç –∫ –∞–≤–∞—Ç–∞—Ä—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–∏–Ω–∏—Ü–∏–∞–ª –∏–º–µ–Ω–∏)

## üé® –í–∏–∑—É–∞–ª—å–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- **–ó–µ–ª–µ–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –∫–∞–º–µ—Ä—ã** - –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤–æ–≥–æ –∞–≤–∞—Ç–∞—Ä–∞
- **–ö—Ä–∞—Å–Ω–∞—è –∫–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è** - —É–¥–∞–ª–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –∞–≤–∞—Ç–∞—Ä–∞
- **–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏** - CircularProgress –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ

### –ê–≤–∞—Ç–∞—Ä:
- **–†–∞–∑–º–µ—Ä**: 80x80 –ø–∏–∫—Å–µ–ª–µ–π
- **Fallback**: –ü–µ—Ä–≤–∞—è –±—É–∫–≤–∞ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–¶–≤–µ—Ç —Ñ–æ–Ω–∞**: #4CAF50 (–∑–µ–ª–µ–Ω—ã–π)
- **URL**: `http://localhost:8080/api/v1/users/avatar/{filename}`

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –∞–≤–∞—Ç–∞—Ä–∞:
1. –í–æ–π—Ç–∏ –≤ –ø—Ä–æ—Ñ–∏–ª—å
2. –ù–∞–∂–∞—Ç—å –Ω–∞ –∏–∫–æ–Ω–∫—É –∫–∞–º–µ—Ä—ã
3. –í—ã–±—Ä–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (JPG, PNG, GIF)
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ

### –¢–µ—Å—Ç —É–¥–∞–ª–µ–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–∞:
1. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –∞–≤–∞—Ç–∞—Ä –∑–∞–≥—Ä—É–∂–µ–Ω
2. –ù–∞–∂–∞—Ç—å –Ω–∞ –∫—Ä–∞—Å–Ω—É—é –∏–∫–æ–Ω–∫—É —É–¥–∞–ª–µ–Ω–∏—è
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–æ–∑–≤—Ä–∞—Ç –∫ –∞–≤–∞—Ç–∞—Ä—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

### –¢–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏:
1. –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–µ-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ ‚Üí –û—à–∏–±–∫–∞
2. –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª > 5MB ‚Üí –û—à–∏–±–∫–∞
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `window.location.reload()` –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
- **–•—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤**: –§–∞–π–ª—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ø–∞–ø–∫–µ `uploads/avatars/`
- **URL –∞–≤–∞—Ç–∞—Ä–∞**: –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∫–∞–∫ `/api/v1/users/avatar/{filename}`
- **Fallback**: –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –∞–≤–∞—Ç–∞—Ä–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–µ—Ä–≤–∞—è –±—É–∫–≤–∞ –∏–º–µ–Ω–∏

## üöÄ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é:
- ‚úÖ Backend endpoints —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ Frontend –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≥–æ—Ç–æ–≤
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
