# –£–ª—É—á—à–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üéØ –¶–µ–ª—å

–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É, –≥–¥–µ –ø–æ–ª–µ –¥–ª—è –≤–≤–æ–¥–∞ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–¥–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏.

## üîÑ –ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø—ã –ø—Ä–æ—Ü–µ—Å—Å–∞:

1. **–í–≤–æ–¥ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞** ‚Üí –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–¥–∞
2. **–í–≤–æ–¥ –∫–æ–¥–∞** ‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ (–±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
3. **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**:
   - **–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** ‚Üí –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª–µ –∏–º–µ–Ω–∏ ‚Üí –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
   - **–°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** ‚Üí –°—Ä–∞–∑—É –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å

## üõ†Ô∏è Backend –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –ù–æ–≤—ã–π endpoint: `/api/v1/auth/check-code`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–∏–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**Request:**
```json
{
  "phone": "+79001234567",
  "code": "123456"
}
```

**Response (–Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å):**
```json
{
  "success": true,
  "message": "–ö–æ–¥ –≤–µ—Ä–Ω—ã–π",
  "isNewUser": true,
  "phone": "79001234567"
}
```

**Response (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å):**
```json
{
  "success": true,
  "message": "–ö–æ–¥ –≤–µ—Ä–Ω—ã–π",
  "isNewUser": false,
  "phone": "79001234567"
}
```

**–õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
```java
// –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
Optional<User> existingUser = userService.getUserByPhone(normalizedPhone);
boolean isNewUser = existingUser.isEmpty() || 
                   (existingUser.isPresent() && 
                    (existingUser.get().getName() == null || 
                     existingUser.get().getName().trim().isEmpty()));
```

## üé® Frontend –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –ù–æ–≤—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞:

```typescript
const [codeVerified, setCodeVerified] = useState(false); // –ö–æ–¥ –ø—Ä–æ–≤–µ—Ä–µ–Ω
const [isNewUser, setIsNewUser] = useState(false); // –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
const [codeCheckLoading, setCodeCheckLoading] = useState(false); // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–¥–∞
```

### –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–¥–∞:

```typescript
const handleCheckCode = async () => {
  if (!code.trim()) {
    setValidationErrors({ code: t('phone.code_required') });
    return;
  }

  setCodeCheckLoading(true);
  setValidationErrors({});

  try {
    const result = await apiService.checkCode(phone, code);
    
    if (result.success) {
      setCodeVerified(true);
      setIsNewUser(result.isNewUser);
      
      // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–æ–≤—ã–π, —Å—Ä–∞–∑—É –∞–≤—Ç–æ—Ä–∏–∑—É–µ–º
      if (!result.isNewUser) {
        await loginWithPhone(phone, code);
        const from = location.state?.from?.pathname || '/profile';
        navigate(from, { replace: true });
      }
    }
  } catch (err: any) {
    setValidationErrors({ code: err.message || '–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥' });
  } finally {
    setCodeCheckLoading(false);
  }
};
```

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è:

```typescript
const validatePhoneForm = () => {
  const errors: { phone?: string; code?: string; name?: string } = {};

  if (!phone.trim()) {
    errors.phone = t('phone.phone_required');
  } else if (!/^[+]?[0-9\s\-()]{10,15}$/.test(phone)) {
    errors.phone = t('phone.phone_invalid');
  }

  if (codeSent && !code.trim()) {
    errors.code = t('phone.code_required');
  }

  // –í–∞–ª–∏–¥–∞—Ü–∏—è –∏–º–µ–Ω–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–¥–∞
  if (codeVerified && isNewUser && !name.trim()) {
    errors.name = t('phone.name_required');
  }

  setValidationErrors(errors);
  return Object.keys(errors).length === 0;
};
```

## üé≠ UI/UX –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –¢—Ä–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:

#### 1. –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–¥–∞
```jsx
{!codeSent ? (
  <Button onClick={handleSendCode}>
    –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥
  </Button>
) : ...}
```

#### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞
```jsx
{!codeVerified ? (
  <>
    <TextField label="–ö–æ–¥ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏" />
    <Button onClick={handleCheckCode}>
      –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥
    </Button>
  </>
) : ...}
```

#### 3. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
```jsx
{codeVerified ? (
  <>
    <Alert severity="success">
      –ö–æ–¥ –ø—Ä–æ–≤–µ—Ä–µ–Ω —É—Å–ø–µ—à–Ω–æ!
      {isNewUser ? ' –í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.' : ' –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!'}
    </Alert>

    {isNewUser && (
      <TextField 
        label="–ò–º—è" 
        helperText="–ò–º—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"
      />
    )}

    <Button type="submit">
      {isNewUser ? '–ó–∞–≤–µ—Ä—à–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é' : '–í–æ–π—Ç–∏'}
    </Button>
  </>
) : null}
```

## üåê –ù–æ–≤—ã–µ –ø–µ—Ä–µ–≤–æ–¥—ã

### –†—É—Å—Å–∫–∏–π:
```typescript
'phone.name_required': '–ò–º—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π'
```

### English:
```typescript
'phone.name_required': 'Name is required for new users'
```

## üîß API Service –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –ù–æ–≤—ã–π –º–µ—Ç–æ–¥:

```typescript
async checkCode(phone: string, code: string) {
  const response = await api.post('/auth/check-code', {
    phone,
    code
  });
  return response.data;
}
```

## üìã –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–∏

### ‚úÖ –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
- **–£–ø—Ä–æ—â–µ–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å** –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–ü–æ–Ω—è—Ç–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏** –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤–≤–æ–¥–∞ –∏–º–µ–Ω–∏
- **–ú–µ–Ω—å—à–µ –ø–æ–ª–µ–π** –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –≤—Ö–æ–¥–µ

### ‚úÖ –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:
- **–ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ** –ª–æ–≥–∏–∫–∏ –¥–ª—è –Ω–æ–≤—ã—Ö –∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–õ—É—á—à–∏–π UX** —Å –ø–æ—à–∞–≥–æ–≤—ã–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º
- **–ì–∏–±–∫–æ—Å—Ç—å** –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ä–∞–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

### ‚úÖ –î–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞** –ø–µ—Ä–µ–¥ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º —Ç–∏–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–í–∞–ª–∏–¥–∞—Ü–∏—è** —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–æ–ª–µ–π
- **–ó–∞—â–∏—Ç–∞** –æ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
1. –í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ ‚Üí –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–¥
2. –í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ ‚Üí –ù–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥"
3. –£–≤–∏–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ "–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏"
4. –í–≤–µ–¥–∏—Ç–µ –∏–º—è ‚Üí –ù–∞–∂–º–∏—Ç–µ "–ó–∞–≤–µ—Ä—à–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é"

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
1. –í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ ‚Üí –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–¥
2. –í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ ‚Üí –ù–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥"
3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑—É–µ—Ç–µ—Å—å –∏ –ø–µ—Ä–µ–π–¥–µ—Ç–µ –≤ –ø—Ä–æ—Ñ–∏–ª—å

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- **–ö–æ–¥ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –¥–≤–∞–∂–¥—ã**: —Å–Ω–∞—á–∞–ª–∞ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–∏–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∑–∞—Ç–µ–º –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- **–ü–æ–ª–µ –∏–º–µ–Ω–∏** –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–í–∞–ª–∏–¥–∞—Ü–∏—è –∏–º–µ–Ω–∏** –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
